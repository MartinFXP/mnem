---
title: "Time integrative Nested Effects Models (tinNEM) \n
Integrating unpertrubed time series data and static perturbation data for pathway inference.."
author: "Martin Pirkl, Niko Beerenwinkel"
date: "`r Sys.Date()`"
output: BiocStyle::pdf_document
vignette: >
    %\VignetteIndexEntry{tinnem}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---
	
# Introduction & quick start

# Loading epiNEM

```{r, global_options, include=FALSE}
knitr::opts_chunk$set(message=FALSE)
```
```{r}

library(nem)
library(graph)
source("~/Documents/mnem/R/mnems.r")
source("~/Documents/mnem/R/mnems_low.r")

noises <- c(0, 0.5, 1, 2)

Sgenes <- 5
Egenes <- 10
steps <- 20

noise <- 3

reps <- 2

sim <- simData(Sgenes = Sgenes, Egenes = Egenes, reps = 3, Nems = 1)
 
data <- sim$data

timeseries <- data[, sample(1:ncol(data), steps, replace = TRUE)]

data <- data + rnorm(length(sim$data), 0, noises[noise])

timeseries <- timeseries + rnorm(steps, 0, noises[noise])

source("~/Documents/mnem/R/mnems_low.r")

res <- tinem(data, timeseries = timeseries, verbose = TRUE, evolution = F)#TRUE)

acc <- numeric(100)

acc2 <- numeric(100)

for (i in 1:10) {
    
    sim <- simData(Sgenes = Sgenes, Egenes = Egenes, reps = 3, Nems = 1)
    data <- sim$data
    timeseries <- data[, sample(1:ncol(data), steps, replace = TRUE)]
    data <- data + rnorm(length(sim$data), 0, noises[noise])
    timeseries <- timeseries + rnorm(steps, 0, noises[noise])

    res <- tinem(data, timeseries = timeseries, verbose = TRUE, evolution = F)

    tp <- sum(res$adj == 1 & sim$Nem[[1]] == 1)
    fp <- sum(res$adj == 1 & sim$Nem[[1]] == 0)
    fn <- sum(res$adj == 0 & sim$Nem[[1]] == 1)
    tn <- sum(res$adj == 0 & sim$Nem[[1]] == 0)

    acc[i] <- (tp+tn)/(tp+tn+fp+fn)

    res <- mynem(data)

    tp <- sum(res$adj == 1 & sim$Nem[[1]] == 1)
    fp <- sum(res$adj == 1 & sim$Nem[[1]] == 0)
    fn <- sum(res$adj == 0 & sim$Nem[[1]] == 1)
    tn <- sum(res$adj == 0 & sim$Nem[[1]] == 0)

    acc2[i] <- (tp+tn)/(tp+tn+fp+fn)

}

plot(acc, xlim = c(0, sum(acc != 0)))
lines(acc2, col = 2, type = "p", pch = "X")

```

# Session information

```{r}
sessionInfo()
```

# References

Martin Pirkl, Niko Beerenwinkel. Identification of sub population networks
from a mixture of single cell perturbation screens. In preperation.

Martin Pirkl, Madeline Diekmann, Marlies van der Wees, Niko Beerenwinkel,
Holger FrÃ¶hlich, Florian Markowetz. Inferring Modulators of Genetic
Interactions with Epistatic Nested Effects Models. In revision. 2017.

Markowetz F, Bloch J, Spang R. Non-transcriptional pathway features
reconstructed from secondary effects of RNA interference. Bioinformatics.
2005;21(21):4026--4032.

Pirkl M, Hand E, Kube D, Spang R. Analyzing synergistic and non-synergistic
interactions in signalling pathways using Boolean Nested Effect Models.
Bioinformatics. 2016;32(6):893--900.
